name: Extract All Assets.car Files

on:
  workflow_dispatch:

jobs:
  extract-all:
    runs-on: macos-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Create output folders and extract each .car file
        run: |
          mkdir -p extracted
          for carfile in Assets/*.car; do
            # Get base name without extension
            base=$(basename "$carfile" .car)
            outdir="Assets/$base"
            mkdir -p "$outdir"
            echo "Extracting $carfile to $outdir"

            # Dump info.json as well
            /usr/bin/xcrun assetutil --info "$carfile" > "$outdir/info.json"
            # Extract all images
            /usr/bin/xcrun assetutil --output "$outdir" --extract "$carfile"
          done

      - name: Upload extracted folders as artifact
        uses: actions/upload-artifact@v4
        with:
          name: extracted-assets
          path: Assets/*
